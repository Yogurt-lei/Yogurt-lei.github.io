import{_ as n}from"./_plugin-vue_export-helper.cdc0426e.js";import{o as s,c as a,b as t}from"./app.5eaf0eaa.js";const p={},o=t(`<h1 id="di-jenkinsfile" tabindex="-1"><a class="header-anchor" href="#di-jenkinsfile" aria-hidden="true">#</a> di jenkinsfile</h1><div class="language-groovy line-numbers-mode" data-ext="groovy"><pre class="language-groovy"><code><span class="token shebang comment">#!/usr/bin/env groovy</span>

<span class="token keyword">void</span> <span class="token function">setBuildStatus</span><span class="token punctuation">(</span>String message<span class="token punctuation">,</span> String state<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    sh <span class="token string">&#39;git rev-parse HEAD &gt; .git/current-commit&#39;</span>
    commitSha <span class="token operator">=</span> <span class="token function">readFile</span><span class="token punctuation">(</span><span class="token string">&#39;.git/current-commit&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token function">step</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
      <span class="token punctuation">$</span><span class="token keyword">class</span><span class="token punctuation">:</span> <span class="token string">&#39;GitHubCommitStatusSetter&#39;</span><span class="token punctuation">,</span>
      reposSource<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">$</span><span class="token keyword">class</span><span class="token punctuation">:</span> <span class="token string">&#39;ManuallyEnteredRepositorySource&#39;</span><span class="token punctuation">,</span> url<span class="token punctuation">:</span> <span class="token string">&#39;https://&#39;</span> <span class="token operator">+</span> env<span class="token punctuation">.</span>GITRepositoryURL<span class="token punctuation">]</span><span class="token punctuation">,</span>
      commitShaSource<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">$</span><span class="token keyword">class</span><span class="token punctuation">:</span> <span class="token string">&#39;ManuallyEnteredShaSource&#39;</span><span class="token punctuation">,</span> sha<span class="token punctuation">:</span> commitSha<span class="token punctuation">]</span><span class="token punctuation">,</span>
      contextSource<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">$</span><span class="token keyword">class</span><span class="token punctuation">:</span> <span class="token string">&#39;ManuallyEnteredCommitContextSource&#39;</span><span class="token punctuation">,</span> context<span class="token punctuation">:</span> <span class="token string">&#39;DI-iflow CI&#39;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
      errorHandlers<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token punctuation">$</span><span class="token keyword">class</span><span class="token punctuation">:</span> <span class="token string">&#39;ChangingBuildStatusErrorHandler&#39;</span><span class="token punctuation">,</span> result<span class="token punctuation">:</span> <span class="token string">&#39;UNSTABLE&#39;</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
      statusResultSource<span class="token punctuation">:</span> <span class="token punctuation">[</span> <span class="token punctuation">$</span><span class="token keyword">class</span><span class="token punctuation">:</span> <span class="token string">&#39;ConditionalStatusResultSource&#39;</span><span class="token punctuation">,</span> results<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token punctuation">$</span><span class="token keyword">class</span><span class="token punctuation">:</span> <span class="token string">&#39;AnyBuildResult&#39;</span><span class="token punctuation">,</span> message<span class="token punctuation">:</span> message<span class="token punctuation">,</span> state<span class="token punctuation">:</span> state<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token punctuation">]</span>
  <span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

pipeline <span class="token punctuation">{</span>
    agent any

    parameters <span class="token punctuation">{</span>
        <span class="token function">string</span><span class="token punctuation">(</span>name<span class="token punctuation">:</span> <span class="token string">&#39;tag_version&#39;</span><span class="token punctuation">,</span> defaultValue<span class="token punctuation">:</span> <span class="token string">&#39;&#39;</span><span class="token punctuation">,</span> description<span class="token punctuation">:</span> <span class="token string">&#39;version to tag for release&#39;</span><span class="token punctuation">)</span>
        <span class="token function">string</span><span class="token punctuation">(</span>name<span class="token punctuation">:</span> <span class="token string">&#39;tag_hash&#39;</span><span class="token punctuation">,</span> defaultValue<span class="token punctuation">:</span> <span class="token string">&#39;&#39;</span><span class="token punctuation">,</span> description<span class="token punctuation">:</span> <span class="token string">&#39;hash to tag for release&#39;</span><span class="token punctuation">)</span>
        <span class="token function">string</span><span class="token punctuation">(</span>name<span class="token punctuation">:</span> <span class="token string">&#39;release_note&#39;</span><span class="token punctuation">,</span> defaultValue<span class="token punctuation">:</span> <span class="token string">&#39;&#39;</span><span class="token punctuation">,</span> description<span class="token punctuation">:</span> <span class="token string">&#39;release note for this tag&#39;</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    environment <span class="token punctuation">{</span>
        PackageId <span class="token operator">=</span> <span class="token string">&#39;DataIngestionforIndustryCloudSolutionswithSAPS4HANA&#39;</span>
        CPIHost <span class="token operator">=</span> <span class="token string">&#39;cic-cpi-content-publish.it-accd003.cfapps.eu12.hana.ondemand.com&#39;</span>
        CPIOAuthHost <span class="token operator">=</span> <span class="token string">&#39;cic-cpi-content-publish.authentication.eu12.hana.ondemand.com&#39;</span>
        GITRepositoryURL <span class="token operator">=</span> <span class="token string">&#39;github.tools.sap/cornerstone/data-ingestion-with-s4&#39;</span>
        CPIOAuthCredentials <span class="token operator">=</span> <span class="token string">&#39;auth_for_cic-cpi-content-publish&#39;</span>
        GITCredentials <span class="token operator">=</span> <span class="token string">&#39;di4iciflows-serviceuser&#39;</span>
        GITBranch <span class="token operator">=</span> <span class="token string">&#39;develop&#39;</span>
        GITFolder <span class="token operator">=</span> <span class="token string">&#39;IntegrationContent/IntegrationArtifacts&#39;</span>
        GITComment <span class="token operator">=</span> <span class="token string">&#39;Integration Package update from CICD pipeline&#39;</span>
    <span class="token punctuation">}</span>

    stages <span class="token punctuation">{</span>
        <span class="token function">stage</span><span class="token punctuation">(</span><span class="token string">&#39;checkout&#39;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            steps <span class="token punctuation">{</span>
                <span class="token function">deleteDir</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                git branch<span class="token punctuation">:</span> env<span class="token punctuation">.</span>GITBranch<span class="token punctuation">,</span> credentialsId<span class="token punctuation">:</span> env<span class="token punctuation">.</span>GITCredentials<span class="token punctuation">,</span> url<span class="token punctuation">:</span> <span class="token string">&#39;http://&#39;</span> <span class="token operator">+</span> env<span class="token punctuation">.</span>GITRepositoryURL
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>

        <span class="token function">stage</span><span class="token punctuation">(</span><span class="token string">&#39;cpi token&#39;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            steps <span class="token punctuation">{</span>
                script <span class="token punctuation">{</span>
                    <span class="token keyword">def</span> cpiTokenResponse <span class="token operator">=</span> httpRequest acceptType<span class="token punctuation">:</span> <span class="token string">&#39;APPLICATION_JSON&#39;</span><span class="token punctuation">,</span>
                                url<span class="token punctuation">:</span> <span class="token string">&#39;https://&#39;</span> <span class="token operator">+</span> env<span class="token punctuation">.</span>CPIOAuthHost <span class="token operator">+</span> <span class="token string">&#39;/oauth/token?grant_type=client_credentials&#39;</span><span class="token punctuation">,</span>
                                authentication<span class="token punctuation">:</span> env<span class="token punctuation">.</span>CPIOAuthCredentials<span class="token punctuation">,</span>
                                responseHandle<span class="token punctuation">:</span> <span class="token string">&#39;LEAVE_OPEN&#39;</span>

                    <span class="token keyword">def</span> jsonObj <span class="token operator">=</span> readJSON text<span class="token punctuation">:</span> cpiTokenResponse<span class="token punctuation">.</span>content
                    cpiToken <span class="token operator">=</span> <span class="token string">&#39;bearer &#39;</span> <span class="token operator">+</span> jsonObj<span class="token punctuation">.</span>access_token
                    cpiTokenResponse<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>

        <span class="token function">stage</span><span class="token punctuation">(</span><span class="token string">&#39;pkg sync&#39;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            steps <span class="token punctuation">{</span>
                script <span class="token punctuation">{</span>
                    <span class="token comment">// set git commit env</span>
                    env<span class="token punctuation">.</span>GIT_COMMITTER_NAME <span class="token operator">=</span> <span class="token interpolation-string"><span class="token string">&quot;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span><span class="token expression">env<span class="token punctuation">.</span>GITCredentials</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&quot;</span></span>
                    env<span class="token punctuation">.</span>GIT_AUTHOR_NAME <span class="token operator">=</span> <span class="token interpolation-string"><span class="token string">&quot;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span><span class="token expression">env<span class="token punctuation">.</span>GITCredentials</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&quot;</span></span>
                    env<span class="token punctuation">.</span>GIT_COMMITTER_EMAIL <span class="token operator">=</span> <span class="token string">&#39;dl_62e23f3f3fe6dd029b031c78@global.corp.sap&#39;</span>
                    env<span class="token punctuation">.</span>GIT_AUTHOR_EMAIL <span class="token operator">=</span> <span class="token string">&#39;dl_62e23f3f3fe6dd029b031c78@global.corp.sap&#39;</span>
                    <span class="token keyword">def</span> pkgInfoResp <span class="token operator">=</span> httpRequest acceptType<span class="token punctuation">:</span> <span class="token string">&#39;APPLICATION_JSON&#39;</span><span class="token punctuation">,</span>
                                    customHeaders<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">[</span>maskValue<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> name<span class="token punctuation">:</span> <span class="token string">&#39;Authorization&#39;</span><span class="token punctuation">,</span> value<span class="token punctuation">:</span> <span class="token interpolation-string"><span class="token string">&quot;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span><span class="token expression">cpiToken</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                                    ignoreSslErrors<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
                                    validResponseCodes<span class="token punctuation">:</span> <span class="token string">&#39;200:299,404&#39;</span><span class="token punctuation">,</span>
                                    responseHandle<span class="token punctuation">:</span> <span class="token string">&#39;LEAVE_OPEN&#39;</span><span class="token punctuation">,</span>
                                    timeout<span class="token punctuation">:</span> <span class="token number">30</span><span class="token punctuation">,</span>
                                    url<span class="token punctuation">:</span> <span class="token string">&#39;https://&#39;</span> <span class="token operator">+</span> env<span class="token punctuation">.</span>CPIHost <span class="token operator">+</span> <span class="token string">&#39;/api/v1/IntegrationPackages(\\&#39;&#39;</span> <span class="token operator">+</span> env<span class="token punctuation">.</span>PackageId <span class="token operator">+</span> <span class="token string">&#39;\\&#39;)&#39;</span>

                    <span class="token keyword">if</span> <span class="token punctuation">(</span>pkgInfoResp<span class="token punctuation">.</span>status <span class="token operator">==</span> <span class="token number">404</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        pkgInfoResp<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                        error <span class="token string">&#39;received http 404. Please check the Flow ID you provided in the script. Looks like it does not exist on the tenant.&#39;</span>
                    <span class="token punctuation">}</span>
                    <span class="token keyword">def</span> pkgInfo <span class="token operator">=</span> readJSON text<span class="token punctuation">:</span> pkgInfoResp<span class="token punctuation">.</span>content
                    <span class="token keyword">def</span> cpiVersion <span class="token operator">=</span> pkgInfo<span class="token punctuation">.</span>d<span class="token punctuation">.</span>Version
                    <span class="token keyword">def</span> artifactsUrl <span class="token operator">=</span> pkgInfo<span class="token punctuation">.</span>d<span class="token punctuation">.</span>IntegrationDesigntimeArtifacts<span class="token punctuation">.</span>__deferred
                    <span class="token keyword">def</span> messageMappingsUrl <span class="token operator">=</span> pkgInfo<span class="token punctuation">.</span>d<span class="token punctuation">.</span>MessageMappingDesigntimeArtifacts<span class="token punctuation">.</span>__deferred

                    echo <span class="token interpolation-string"><span class="token string">&quot;Package version on Cloud Integration tenant: &#39;&quot;</span></span> <span class="token operator">+</span> cpiVersion <span class="token operator">+</span> <span class="token interpolation-string"><span class="token string">&quot;&#39;&quot;</span></span>
                    pkgInfoResp<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

                    <span class="token comment">// download artifacts</span>
                    <span class="token keyword">def</span> artifactsResp <span class="token operator">=</span> httpRequest acceptType<span class="token punctuation">:</span> <span class="token string">&#39;APPLICATION_JSON&#39;</span><span class="token punctuation">,</span>
                                    customHeaders<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">[</span>maskValue<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> name<span class="token punctuation">:</span> <span class="token string">&#39;Authorization&#39;</span><span class="token punctuation">,</span> value<span class="token punctuation">:</span> <span class="token interpolation-string"><span class="token string">&quot;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span><span class="token expression">cpiToken</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                                    ignoreSslErrors<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
                                    responseHandle<span class="token punctuation">:</span> <span class="token string">&#39;LEAVE_OPEN&#39;</span><span class="token punctuation">,</span>
                                    timeout<span class="token punctuation">:</span> <span class="token number">30</span><span class="token punctuation">,</span>
                                    url<span class="token punctuation">:</span> artifactsUrl<span class="token punctuation">.</span>uri
                    <span class="token keyword">def</span> artifacts <span class="token operator">=</span> readJSON text<span class="token punctuation">:</span> artifactsResp<span class="token punctuation">.</span>content
                    artifactsResp<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                    <span class="token keyword">for</span> <span class="token punctuation">(</span>artifact <span class="token keyword">in</span> artifacts<span class="token punctuation">.</span>d<span class="token punctuation">.</span>results<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        <span class="token keyword">def</span> media_src <span class="token operator">=</span> artifact<span class="token punctuation">.</span>__metadata<span class="token punctuation">.</span>media_src
                        echo <span class="token string">&#39;Download artefact &#39;</span> <span class="token operator">+</span> media_src
                        <span class="token keyword">def</span> tempfile <span class="token operator">=</span> UUID<span class="token punctuation">.</span><span class="token function">randomUUID</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&#39;.zip&#39;</span>
                        <span class="token keyword">def</span> cpiFlowResponse <span class="token operator">=</span> httpRequest acceptType<span class="token punctuation">:</span> <span class="token string">&#39;APPLICATION_ZIP&#39;</span><span class="token punctuation">,</span>
                        customHeaders<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">[</span>maskValue<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> name<span class="token punctuation">:</span> <span class="token string">&#39;Authorization&#39;</span><span class="token punctuation">,</span> value<span class="token punctuation">:</span> <span class="token interpolation-string"><span class="token string">&quot;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span><span class="token expression">cpiToken</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                        ignoreSslErrors<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
                        responseHandle<span class="token punctuation">:</span> <span class="token string">&#39;LEAVE_OPEN&#39;</span><span class="token punctuation">,</span>
                        timeout<span class="token punctuation">:</span> <span class="token number">30</span><span class="token punctuation">,</span>
                        outputFile<span class="token punctuation">:</span> tempfile<span class="token punctuation">,</span>
                        url<span class="token punctuation">:</span> media_src

                        <span class="token comment">// [attachment; filename=&quot;characteristic_codes_payload_customization.zip&quot;]</span>
                        <span class="token keyword">def</span> filename <span class="token operator">=</span> cpiFlowResponse<span class="token punctuation">.</span>headers<span class="token punctuation">[</span><span class="token string">&#39;content-disposition&#39;</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">minus</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">&quot;attachment; filename=\\&quot;&quot;</span></span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">minus</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">&quot;.zip\\&quot;&quot;</span></span><span class="token punctuation">)</span>
                        <span class="token function">fileOperations</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token function">fileUnZipOperation</span><span class="token punctuation">(</span>filePath<span class="token punctuation">:</span> tempfile<span class="token punctuation">,</span> targetLocation<span class="token punctuation">:</span> env<span class="token punctuation">.</span>GITFolder <span class="token operator">+</span> <span class="token string">&#39;/&#39;</span> <span class="token operator">+</span> filename<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
                        cpiFlowResponse<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                    <span class="token punctuation">}</span>

                    <span class="token comment">// download messagemappings</span>
                    <span class="token keyword">def</span> messageMappingsResp <span class="token operator">=</span> httpRequest acceptType<span class="token punctuation">:</span> <span class="token string">&#39;APPLICATION_JSON&#39;</span><span class="token punctuation">,</span>
                                    customHeaders<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">[</span>maskValue<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> name<span class="token punctuation">:</span> <span class="token string">&#39;Authorization&#39;</span><span class="token punctuation">,</span> value<span class="token punctuation">:</span> <span class="token interpolation-string"><span class="token string">&quot;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span><span class="token expression">cpiToken</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                                    ignoreSslErrors<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
                                    responseHandle<span class="token punctuation">:</span> <span class="token string">&#39;LEAVE_OPEN&#39;</span><span class="token punctuation">,</span>
                                    timeout<span class="token punctuation">:</span> <span class="token number">30</span><span class="token punctuation">,</span>
                                    url<span class="token punctuation">:</span> messageMappingsUrl<span class="token punctuation">.</span>uri
                    <span class="token keyword">def</span> messageMappings <span class="token operator">=</span> readJSON text<span class="token punctuation">:</span> messageMappingsResp<span class="token punctuation">.</span>content
                    messageMappingsResp<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

                    <span class="token keyword">for</span> <span class="token punctuation">(</span>messageMapping <span class="token keyword">in</span> messageMappings<span class="token punctuation">.</span>d<span class="token punctuation">.</span>results<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        <span class="token keyword">def</span> media_src <span class="token operator">=</span> messageMapping<span class="token punctuation">.</span>__metadata<span class="token punctuation">.</span>media_src
                        echo <span class="token string">&#39;Download messageMapping &#39;</span> <span class="token operator">+</span> media_src
                        <span class="token keyword">def</span> tempfile <span class="token operator">=</span> UUID<span class="token punctuation">.</span><span class="token function">randomUUID</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&#39;.zip&#39;</span>
                        <span class="token keyword">def</span> cpiFlowResponse <span class="token operator">=</span> httpRequest acceptType<span class="token punctuation">:</span> <span class="token string">&#39;APPLICATION_ZIP&#39;</span><span class="token punctuation">,</span>
                        customHeaders<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">[</span>maskValue<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> name<span class="token punctuation">:</span> <span class="token string">&#39;Authorization&#39;</span><span class="token punctuation">,</span> value<span class="token punctuation">:</span> <span class="token interpolation-string"><span class="token string">&quot;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span><span class="token expression">cpiToken</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                        ignoreSslErrors<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
                        responseHandle<span class="token punctuation">:</span> <span class="token string">&#39;LEAVE_OPEN&#39;</span><span class="token punctuation">,</span>
                        timeout<span class="token punctuation">:</span> <span class="token number">30</span><span class="token punctuation">,</span>
                        outputFile<span class="token punctuation">:</span> tempfile<span class="token punctuation">,</span>
                        url<span class="token punctuation">:</span> media_src

                        <span class="token comment">// [attachment; filename=&quot;characteristic_codes_payload_customization.zip&quot;]</span>
                        <span class="token keyword">def</span> filename <span class="token operator">=</span> cpiFlowResponse<span class="token punctuation">.</span>headers<span class="token punctuation">[</span><span class="token string">&#39;content-disposition&#39;</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">minus</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">&quot;attachment; filename=\\&quot;&quot;</span></span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">minus</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">&quot;.zip\\&quot;&quot;</span></span><span class="token punctuation">)</span>
                        <span class="token function">fileOperations</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token function">fileUnZipOperation</span><span class="token punctuation">(</span>filePath<span class="token punctuation">:</span> tempfile<span class="token punctuation">,</span> targetLocation<span class="token punctuation">:</span> env<span class="token punctuation">.</span>GITFolder <span class="token operator">+</span> <span class="token string">&#39;/&#39;</span> <span class="token operator">+</span> filename<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
                        cpiFlowResponse<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                    <span class="token punctuation">}</span>

                    <span class="token comment">// clean up</span>
                    <span class="token function">fileOperations</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token function">fileDeleteOperation</span><span class="token punctuation">(</span>excludes<span class="token punctuation">:</span> <span class="token string">&#39;&#39;</span><span class="token punctuation">,</span> includes<span class="token punctuation">:</span> <span class="token string">&#39;*.zip&#39;</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
                    <span class="token function">dir</span><span class="token punctuation">(</span>env<span class="token punctuation">.</span>GITFolder<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        sh <span class="token string">&#39;git add .&#39;</span>
                    <span class="token punctuation">}</span>
                    <span class="token function">withCredentials</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token punctuation">$</span><span class="token keyword">class</span><span class="token punctuation">:</span> <span class="token string">&#39;UsernamePasswordMultiBinding&#39;</span><span class="token punctuation">,</span> credentialsId<span class="token punctuation">:</span> env<span class="token punctuation">.</span>GITCredentials <span class="token punctuation">,</span>usernameVariable<span class="token punctuation">:</span> <span class="token string">&#39;GitUserName&#39;</span><span class="token punctuation">,</span> passwordVariable<span class="token punctuation">:</span> <span class="token string">&#39;GitPassword&#39;</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        sh <span class="token string">&#39;git diff-index --quiet HEAD || git commit -am &#39;</span> <span class="token operator">+</span> <span class="token string">&#39;\\&#39;&#39;</span> <span class="token operator">+</span> env<span class="token punctuation">.</span>GITComment <span class="token operator">+</span> <span class="token string">&#39;\\&#39;&#39;</span>
                        <span class="token function">sh</span><span class="token punctuation">(</span><span class="token string">&#39;git push https://\${GitUserName}:\${GitPassword}@&#39;</span> <span class="token operator">+</span> env<span class="token punctuation">.</span>GITRepositoryURL  <span class="token operator">+</span> <span class="token string">&#39; HEAD:&#39;</span> <span class="token operator">+</span> env<span class="token punctuation">.</span>GITBranch<span class="token punctuation">)</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>

        <span class="token function">stage</span><span class="token punctuation">(</span><span class="token string">&#39;checkmarx&#39;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            steps <span class="token punctuation">{</span>
                    <span class="token function">step</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
                        <span class="token punctuation">$</span><span class="token keyword">class</span><span class="token punctuation">:</span> <span class="token string">&#39;CxScanBuilder&#39;</span><span class="token punctuation">,</span>
                        comment<span class="token punctuation">:</span> <span class="token string">&#39;&#39;</span><span class="token punctuation">,</span>
                        configAsCode<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
                        customFields<span class="token punctuation">:</span> <span class="token string">&#39;&#39;</span><span class="token punctuation">,</span>
                        excludeFolders<span class="token punctuation">:</span> <span class="token string">&#39;&#39;</span><span class="token punctuation">,</span>
                        exclusionsSetting<span class="token punctuation">:</span> <span class="token string">&#39;job&#39;</span><span class="token punctuation">,</span>
                        failBuildOnNewResults<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
                        failBuildOnNewSeverity<span class="token punctuation">:</span> <span class="token string">&#39;HIGH&#39;</span><span class="token punctuation">,</span>
                        filterPattern<span class="token punctuation">:</span> <span class="token string">&#39;&#39;&#39;**/*.groovy&#39;&#39;&#39;</span><span class="token punctuation">,</span>
                        fullScanCycle<span class="token punctuation">:</span> <span class="token number">10</span><span class="token punctuation">,</span>
                        generatePdfReport<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
                        groupId<span class="token punctuation">:</span> <span class="token string">&#39;438&#39;</span><span class="token punctuation">,</span>
                        highThreshold<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
                        preset<span class="token punctuation">:</span> <span class="token string">&#39;100087&#39;</span><span class="token punctuation">,</span>
                        projectName<span class="token punctuation">:</span> env<span class="token punctuation">.</span>PackageId<span class="token punctuation">,</span>
                        sastEnabled<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
                        sourceEncoding<span class="token punctuation">:</span> <span class="token string">&#39;9&#39;</span><span class="token punctuation">,</span>
                        vulnerabilityThresholdEnabled<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
                        vulnerabilityThresholdResult<span class="token punctuation">:</span> <span class="token string">&#39;FAILURE&#39;</span><span class="token punctuation">,</span>
                        waitForResultsEnabled<span class="token punctuation">:</span> <span class="token boolean">true</span>
                    <span class="token punctuation">]</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>

        <span class="token function">stage</span><span class="token punctuation">(</span><span class="token string">&#39;release action&#39;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            when <span class="token punctuation">{</span>
                expression <span class="token punctuation">{</span>
                    <span class="token keyword">return</span> params<span class="token punctuation">.</span>tag_version <span class="token operator">!=</span> <span class="token string">&#39;&#39;</span> <span class="token operator">&amp;&amp;</span> params<span class="token punctuation">.</span>tag_hash <span class="token operator">!=</span> <span class="token string">&#39;&#39;</span> <span class="token operator">&amp;&amp;</span> params<span class="token punctuation">.</span>release_note <span class="token operator">!=</span> <span class="token string">&#39;&#39;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
            steps <span class="token punctuation">{</span>
                script <span class="token punctuation">{</span>
                    <span class="token function">withCredentials</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token punctuation">$</span><span class="token keyword">class</span><span class="token punctuation">:</span> <span class="token string">&#39;UsernamePasswordMultiBinding&#39;</span><span class="token punctuation">,</span> credentialsId<span class="token punctuation">:</span> env<span class="token punctuation">.</span>GITCredentials<span class="token punctuation">,</span> usernameVariable<span class="token punctuation">:</span> <span class="token string">&#39;GitUserName&#39;</span><span class="token punctuation">,</span> passwordVariable<span class="token punctuation">:</span> <span class="token string">&#39;GitPassword&#39;</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        sh <span class="token interpolation-string"><span class="token string">&quot;git tag -a </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span><span class="token expression">params<span class="token punctuation">.</span>tag_version</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span><span class="token expression">params<span class="token punctuation">.</span>tag_hash</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> -m &#39;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span><span class="token expression">params<span class="token punctuation">.</span>tag_version</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&#39;&quot;</span></span>
                        sh <span class="token interpolation-string"><span class="token string">&quot;git push https://</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span><span class="token expression">GitUserName</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">:</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span><span class="token expression">GitPassword</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">@</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span><span class="token expression">env<span class="token punctuation">.</span>GITRepositoryURL</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span><span class="token expression">params<span class="token punctuation">.</span>tag_version</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&quot;</span></span>
                    <span class="token punctuation">}</span> 

                    <span class="token function">withCredentials</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token punctuation">$</span><span class="token keyword">class</span><span class="token punctuation">:</span> <span class="token string">&#39;UsernamePasswordMultiBinding&#39;</span><span class="token punctuation">,</span> credentialsId<span class="token punctuation">:</span> env<span class="token punctuation">.</span>GITCredentials<span class="token punctuation">,</span> usernameVariable<span class="token punctuation">:</span> <span class="token string">&#39;GitUserName&#39;</span><span class="token punctuation">,</span> passwordVariable<span class="token punctuation">:</span> <span class="token string">&#39;GitPassword&#39;</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        <span class="token keyword">def</span> code <span class="token operator">=</span> <span class="token function">sh</span><span class="token punctuation">(</span>script<span class="token punctuation">:</span> <span class="token interpolation-string"><span class="token string">&quot;&quot;&quot;
                            curl -s  -X POST -H &#39;Accept: application/vnd.github+json&#39; -H &#39;Authorization: token11 </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span><span class="token expression">GitPassword</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&#39; https://github.tools.sap/api/v3/repos/cornerstone/data-ingestion-with-s4/releases -d &#39;{\\&quot;tag_name\\&quot;:\\&quot;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span><span class="token expression">params<span class="token punctuation">.</span>tag_version</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">\\&quot;,\\&quot;target_commitish\\&quot;:\\&quot;309608e1fd895cf9620ee6e9615b2506481e1f12\\&quot;,\\&quot;name\\&quot;:\\&quot;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span><span class="token expression">params<span class="token punctuation">.</span>tag_version</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">\\&quot;,\\&quot;body\\&quot;:\\&quot;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span><span class="token expression">params<span class="token punctuation">.</span>release_note</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">\\&quot;}&#39; -o /dev/null -w &#39;%{response_code}&#39;
                            &quot;&quot;&quot;</span></span><span class="token punctuation">,</span> returnStdout<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">)</span>
                        <span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                        <span class="token keyword">if</span> <span class="token punctuation">(</span>code <span class="token operator">==</span> <span class="token interpolation-string"><span class="token string">&quot;201&quot;</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                            emailext body<span class="token punctuation">:</span> <span class="token interpolation-string"><span class="token string">&quot;&quot;&quot;
                                Hi All:&lt;br/&gt;&lt;br/&gt;
                                
                                I am glad to announce that [CPI : </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span><span class="token expression">env<span class="token punctuation">.</span>PackageId</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">] </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span><span class="token expression">params<span class="token punctuation">.</span>tag_version</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> is released. &lt;br/&gt;
                                You can check the &lt;a href=\\&quot;https://github.tools.sap/cornerstone/data-ingestion-with-s4/releases/tag/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span><span class="token expression">params<span class="token punctuation">.</span>tag_version</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">\\&quot;&gt;release note&lt;/a&gt; for details. &lt;br/&gt;
                                And find new version available in &lt;a href=\\&quot;https://api.sap.com/package/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span><span class="token expression">env<span class="token punctuation">.</span>PackageId</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/overview\\&quot;&gt;Api Business Hub&lt;/a&gt;. &lt;br&gt;

                                &lt;br/&gt;
                                &lt;b&gt;di4iciflows-serviceuser&lt;b&gt;
                            &quot;&quot;&quot;</span></span><span class="token punctuation">,</span> mimeType<span class="token punctuation">:</span> <span class="token string">&#39;text/html&#39;</span><span class="token punctuation">,</span> subject<span class="token punctuation">:</span> <span class="token interpolation-string"><span class="token string">&quot;🚀🚀🚀[CPI : </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span><span class="token expression">env<span class="token punctuation">.</span>PackageId</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">] </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span><span class="token expression">params<span class="token punctuation">.</span>tag_version</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> is released&quot;</span></span><span class="token punctuation">,</span> to<span class="token punctuation">:</span> <span class="token string">&#39;ray.lei01@sap.com&#39;</span>
                        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                            currentBuild<span class="token punctuation">.</span>result <span class="token operator">=</span> <span class="token string">&#39;FAILURE&#39;</span>
                        <span class="token punctuation">}</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    post <span class="token punctuation">{</span>
        success <span class="token punctuation">{</span>
            <span class="token function">setBuildStatus</span><span class="token punctuation">(</span><span class="token string">&#39;Build succeeded&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;SUCCESS&#39;</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
        failure <span class="token punctuation">{</span>
            <span class="token function">setBuildStatus</span><span class="token punctuation">(</span><span class="token string">&#39;Build failed&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;FAILURE&#39;</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,2),e=[o];function c(i,l){return s(),a("div",null,e)}const r=n(p,[["render",c],["__file","jenkins.html.vue"]]);export{r as default};
